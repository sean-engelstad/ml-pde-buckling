import numpy as np
import tensorflow as tf

pi = np.pi

def d2_fact(x, xp, a, L):
    return (-2 - 1.0*x*(1 - (x - xp)**2/L**2)*(a - x)/L**2 + 2.0*x*(x - xp)/L**2 - 2.0*(a - x)*(x - xp)/L**2)/(x*(a - x))

def d4_fact(x, xp, a, L):
    return (12.0 - 4*x*(3.0 - 1.0*(x - xp)**2/L**2)*(x - xp)/L**2 + x*(a - x)*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**2 + 4*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(x - xp)/L**2 - 12.0*(x - xp)**2/L**2)/(L**2*x*(a - x))

def d6_fact(x, xp, a, L):
    return (-24.0 - 8*x*xp*(3.0 - 1.0*(x - xp)**2/L**2)/L**2 + 8*x*(3.0 - 1.0*(x - xp)**2/L**2)*(a - xp)/L**2 + 8*x*(3.0 - 1.0*(x - xp)**2/L**2)*(x - xp)/L**2 - 2*x*(a - x)*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**2 - 12.0*xp*(1 - (x - xp)**2/L**2)*(a - xp)/L**2 - 24.0*xp*(1 - (x - xp)**2/L**2)*(x - xp)/L**2 + 8*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)/L**2 - 24.0*xp*(a - xp)/L**2 - 48.0*xp*(x - xp)/L**2 + 24.0*(1 - (x - xp)**2/L**2)*(a - xp)*(x - xp)/L**2 - 8*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(a - xp)/L**2 - 8*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(x - xp)/L**2 + 48.0*(a - xp)*(x - xp)/L**2 + 24.0*(x - xp)**2/L**2 - 12.0*x*xp*(1 - (x - xp)**2/L**2)*(a - x)*(a - xp)/L**4 + 12.0*x*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - xp)*(x - xp)/L**4 + 8.0*x*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(x - xp)**2/L**4 - 2*x*xp*(12.0 - 4.0*(x - xp)**2/L**2)*(a - x)*(x - xp)/L**4 - 1.0*x*xp*(a - x)*(a - xp)*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**4 - 2.0*x*xp*(a - x)*(x - xp)*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**4 + 24.0*x*xp*(a - xp)*(x - xp)/L**4 + 16.0*x*xp*(x - xp)**2/L**4 - 8.0*x*(3.0 - 1.0*(x - xp)**2/L**2)*(a - xp)*(x - xp)**2/L**4 + 2*x*(12.0 - 4.0*(x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)/L**4 + 2.0*x*(a - x)*(a - xp)*(x - xp)*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**4 - 16.0*x*(a - xp)*(x - xp)**2/L**4 + 12.0*xp*(1 - (x - xp)**2/L**2)*(a - xp)*(x - xp)**2/L**4 - 12.0*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)/L**4 - 8.0*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(x - xp)**2/L**4 - 24.0*xp*(a - x)*(a - xp)*(x - xp)/L**4 - 16.0*xp*(a - x)*(x - xp)**2/L**4 + 48.0*xp*(a - xp)*(x - xp)**2/L**4 + 8.0*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)**2/L**4 + 16.0*(a - x)*(a - xp)*(x - xp)**2/L**4 - 4.0*x*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - xp)*(x - xp)**3/L**6 + 2.0*x*xp*(12.0 - 4.0*(x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)**2/L**6 + 1.0*x*xp*(a - x)*(a - xp)*(x - xp)**2*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**6 - 16.0*x*xp*(a - xp)*(x - xp)**3/L**6 + 4.0*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)**3/L**6 + 16.0*xp*(a - x)*(a - xp)*(x - xp)**3/L**6)/(L**2*x*xp*(a - x)*(a - xp))

def d8_fact(x, xp, a, L):
    return (432.0 + 48.0*x*xp*(3.0 - 1.0*(x - xp)**2/L**2)/L**2 + 96.0*x*xp/L**2 + 144.0*x*(1 - (x - xp)**2/L**2)*(a - x)/L**2 - 48.0*x*(3.0 - 1.0*(x - xp)**2/L**2)*(a - xp)/L**2 - 144.0*x*(3.0 - 1.0*(x - xp)**2/L**2)*(x - xp)/L**2 + 12.0*x*(a - x)*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**2 - 96.0*x*(a - xp)/L**2 - 288.0*x*(x - xp)/L**2 + 36.0*xp*(1 - (x - xp)**2/L**2)*(a - xp)/L**2 + 144.0*xp*(1 - (x - xp)**2/L**2)*(x - xp)/L**2 - 48.0*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)/L**2 - 96.0*xp*(a - x)/L**2 + 144.0*xp*(a - xp)/L**2 + 576.0*xp*(x - xp)/L**2 - 144.0*(1 - (x - xp)**2/L**2)*(a - xp)*(x - xp)/L**2 - 144.0*(1 - (x - xp)**2/L**2)*(x - xp)**2/L**2 + 48.0*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(a - xp)/L**2 + 144.0*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(x - xp)/L**2 + 96.0*(a - x)*(a - xp)/L**2 + 288.0*(a - x)*(x - xp)/L**2 - 576.0*(a - xp)*(x - xp)/L**2 - 720.0*(x - xp)**2/L**2 + 72.0*x*xp*(1 - (x - xp)**2/L**2)*(a - x)*(a - xp)/L**4 + 144.0*x*xp*(1 - (x - xp)**2/L**2)*(a - x)*(x - xp)/L**4 - 60.0*x*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - xp)*(x - xp)/L**4 - 96.0*x*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(x - xp)**2/L**4 + 12.0*x*xp*(12.0 - 4.0*(x - xp)**2/L**2)*(a - x)*(x - xp)/L**4 + 3.0*x*xp*(a - x)*(a - xp)*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**4 + 24.0*x*xp*(a - x)*(a - xp)/L**4 + 12.0*x*xp*(a - x)*(x - xp)*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**4 + 96.0*x*xp*(a - x)*(x - xp)/L**4 - 240.0*x*xp*(a - xp)*(x - xp)/L**4 - 384.0*x*xp*(x - xp)**2/L**4 - 144.0*x*(1 - (x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)/L**4 + 96.0*x*(3.0 - 1.0*(x - xp)**2/L**2)*(a - xp)*(x - xp)**2/L**4 + 48.0*x*(3.0 - 1.0*(x - xp)**2/L**2)*(x - xp)**3/L**4 - 12.0*x*(12.0 - 4.0*(x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)/L**4 - 24.0*x*(12.0 - 4.0*(x - xp)**2/L**2)*(a - x)*(x - xp)**2/L**4 - 12.0*x*(a - x)*(a - xp)*(x - xp)*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**4 - 96.0*x*(a - x)*(a - xp)*(x - xp)/L**4 - 12.0*x*(a - x)*(x - xp)**2*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**4 + 384.0*x*(a - xp)*(x - xp)**2/L**4 + 192.0*x*(x - xp)**3/L**4 - 72.0*xp*(1 - (x - xp)**2/L**2)*(a - xp)*(x - xp)**2/L**4 - 48.0*xp*(1 - (x - xp)**2/L**2)*(x - xp)**3/L**4 + 60.0*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)/L**4 + 96.0*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(x - xp)**2/L**4 + 240.0*xp*(a - x)*(a - xp)*(x - xp)/L**4 + 384.0*xp*(a - x)*(x - xp)**2/L**4 - 432.0*xp*(a - xp)*(x - xp)**2/L**4 - 288.0*xp*(x - xp)**3/L**4 + 48.0*(1 - (x - xp)**2/L**2)*(a - xp)*(x - xp)**3/L**4 - 96.0*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)**2/L**4 - 48.0*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(x - xp)**3/L**4 - 384.0*(a - x)*(a - xp)*(x - xp)**2/L**4 - 192.0*(a - x)*(x - xp)**3/L**4 + 288.0*(a - xp)*(x - xp)**3/L**4 - 72.0*x*xp*(1 - (x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)**2/L**6 + 40.0*x*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - xp)*(x - xp)**3/L**6 + 16.0*x*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(x - xp)**4/L**6 - 12.0*x*xp*(12.0 - 4.0*(x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)**2/L**6 - 12.0*x*xp*(12.0 - 4.0*(x - xp)**2/L**2)*(a - x)*(x - xp)**3/L**6 - 6.0*x*xp*(a - x)*(a - xp)*(x - xp)**2*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**6 - 96.0*x*xp*(a - x)*(a - xp)*(x - xp)**2/L**6 - 4.0*x*xp*(a - x)*(x - xp)**3*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**6 + 240.0*x*xp*(a - xp)*(x - xp)**3/L**6 + 96.0*x*xp*(x - xp)**4/L**6 - 16.0*x*(3.0 - 1.0*(x - xp)**2/L**2)*(a - xp)*(x - xp)**4/L**6 + 12.0*x*(12.0 - 4.0*(x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)**3/L**6 + 4.0*x*(a - x)*(a - xp)*(x - xp)**3*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**6 - 96.0*x*(a - xp)*(x - xp)**4/L**6 + 12.0*xp*(1 - (x - xp)**2/L**2)*(a - xp)*(x - xp)**4/L**6 - 40.0*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)**3/L**6 - 16.0*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(x - xp)**4/L**6 - 240.0*xp*(a - x)*(a - xp)*(x - xp)**3/L**6 - 96.0*xp*(a - x)*(x - xp)**4/L**6 + 96.0*xp*(a - xp)*(x - xp)**4/L**6 + 16.0*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)**4/L**6 + 96.0*(a - x)*(a - xp)*(x - xp)**4/L**6 - 4.0*x*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - xp)*(x - xp)**5/L**8 + 4.0*x*xp*(12.0 - 4.0*(x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)**4/L**8 + 1.0*x*xp*(a - x)*(a - xp)*(x - xp)**4*(3.0 - 6.0*(x - xp)**2/L**2 + 1.0*(x - xp)**4/L**4)/L**8 - 32.0*x*xp*(a - xp)*(x - xp)**5/L**8 + 4.0*xp*(3.0 - 1.0*(x - xp)**2/L**2)*(a - x)*(a - xp)*(x - xp)**5/L**8 + 32.0*xp*(a - x)*(a - xp)*(x - xp)**5/L**8)/(L**4*x*xp*(a - x)*(a - xp))